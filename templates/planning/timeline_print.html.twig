
<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/ico" href="{{ asset('favicon.ico') }}"/>
    <title>FMDA</title>
    <meta name="description" content=""/>

      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<link rel="stylesheet" type="text/css" href="{{ asset('vendor/nestable2/jquery.nestable.min.css') }}">
	<script src="{{ asset('vendor/nestable2/jquery.nestable.min.js') }}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<style type="text/css"  media="print">
	@media print {
		body * {
			visibility: hidden;
		}
		#ct, #ct * {
			visibility: visible;
		}
	}

	@page { size: auto;  margin: 0mm; padding-bottom: 4cm}
</style>

<style type="text/css">
   .timeline-container::-webkit-scrollbar {
       width: 1.1rem;
   }
   *::-webkit-scrollbar-track {
       background-color: #edf2f7;
   }
   *::-webkit-scrollbar-thumb {
       background-color: #718096;
       border-radius: 9999px;
   }
   .timeline-container {
       scrollbar-width: thin;
       /* The color of thumb and track areas */
       scrollbar-color: #718096 #edf2f7;
   }
   .timeline-container{
      cursor: grab;
      overflow: auto;
   }
   td, th{
   height: 100px;
   min-width: 35px;
   }
   table {
   white-space: nowrap;
   margin: 0;
   border: none;
   border-collapse: separate;
   border-spacing: 0;
   table-layout: fixed;
   }
   .timeline-table td{
   border: 1px solid #dedede; 
   border-left: none; 
   }
   .timeline-table tbody td, .timeline-table tbody th{
   border-top: none;
   }
   .timeline-table thead.inner th:first-child{border-bottom: none;}
   .timeline-table .outer > tr > th:first-child, .timeline-table tbody th:first-child{
   border-right: 1px solid #a5a6a8;
   }
   .timeline-table thead.inner tr:first-child td{
   border-bottom: none;
   font-size: 17px;
   }
   tbody th:first-child{border-bottom: 1px solid #dedede;}
   thead.inner tr:nth-child(1) td {
   font-weight: bold;
   }
   tr > th:first-child{
      display: flex;
      align-items: flex-start;
      padding: 7px 12px 9px 7px;
      border-left: 1px solid #dedede;
      border-top: none;
      width: 213px;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      font-size: 11px;
      z-index: 100;
   }
   thead.outer > tr >th, thead.inner td {
   height: 45px;
   font-size: 11px;
   color: #4e4f52;
   font-weight: 300;
   }
   table td, table th {
   padding: 0.5rem 1rem;
   }
   table thead tr > th {
   padding: 0;
   position: sticky;
   top: 0;
   z-index: 1;
   background: white;
   z-index: 200;
   }
   table td {
   background: #fff;
   /*padding: 4px 5px;*/
   padding: 0;
   text-align: center;
   }
   table tbody th {
   font-weight: 100;
   position: relative;
   }
   table thead th:first-child {
   position: sticky;
   left: 0;
   z-index: 201;
   height: 90px;
   }
   table tbody th {
      position: sticky;
      left: 0;
      background: white;
      z-index: 1;
   }
   .timeline-avatar > img {
      width: 37px;
      height: 37px;
      object-fit: cover;
      border-radius: 50%;
   }
   .timeline-info-desc {
      text-align: left;
      margin-left: 11px;
      line-height: 22px;
   }
   tbody .table-cell{height: 100px;}
   tbody .td-timel{
      padding: 0;
      border:none;
   }
   .timeline-container tbody td{
      position: relative;
   }
   .timeline-bar {
    pointer-events: none;
      z-index: 10;
      border-radius: 3px;
      position: absolute;
      left: 56px;
      width: 50px;
      height: 30px;
      background: rgb(255, 21, 138);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grabbing;
   }
   .timeline-bar:hover .crok-resize{
      display: inline-flex;
   }
   .timeline-bar .crok-resize{
       position: absolute;
       display: none;
       background: #5f5f5f;
       color: #fff;
       padding: 1px 1px;
       top: 0;
       bottom: 0;
       align-items: center;
       justify-content: center;
   }
   .timeline-bar .crok-resize.resizable-w{
      left: -6px;
      border-radius: 3px 0 0 3px;
   }
   .timeline-bar .crok-resize.resizable-e{
      right: -6px;
      border-radius: 0 3px 3px 0;
   }
   .td-timel-container .month-bar {
      height: 100%;
       display: inline-block;
       flex: 1;
   }
   .td-timel-container {
       height: 100%;
       width: 100%;
       display: flex;
       justify-content: space-between;
   }
   .content-q-th{
      position: absolute;
      top: 50%;
      bottom: 50%;
      left: 0;
      right:0;
      margin: auto;
      transform: translateY(-50%);
   }
   .timeline-bar:hover {
      min-width: 80px;
   }
   .tooltip-timeline-bar {
      background: #000000c2;
      height: 12px;
      position: absolute;
      left: 0;
      right: 0;
      margin: auto;
      top: -35px;
      height: 100%;
      display: none;
      justify-content: space-between;
      align-items: center;
      padding: 0 11px;
      border-radius: 3px;
      font-size: 14px;
   }
   .timeline-text{
   	position: absolute;
    bottom: -33px;
    color: #616161;
    left: 0;
    right: 0;
    margin-left: auto;
    margin-right: auto;
   }
   .nbr-day-timeline{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: #000;
      font-size: 16px;
      font-weight: 400;
   }
   .rounded-img {
       border-radius: 50%;
       position: relative;
       left: -5px;
       z-index: 1;
       width: 40px;
       height: 40px;
       object-fit: cover;
       transition: easy 0.4s all;
   }
   .td-cell.timeline:hover .clearDate{
      display: inline-block;
   }
   .clearDate {
      display: none;
       position: absolute;
       right: 3px;
       top: 50%;
       transform: translateY(-50%);
       background: #ccc;
       color: #fff;
       height: 16px;
       width: 16px;
       font-size: 11px;
       line-height: 1;
       border-radius: 50%;
       cursor: pointer;
   }
   .clearDate:hover{
      background: #888;
   }


   .tabs-planning-control-list {
       display: flex;
       margin-bottom: 20px;
       margin-top: 38px;
       margin-left: 22px;
       border-bottom: 1px solid #e8e8e8;
       padding-bottom: 9px;
   }
   .tab-planning-control-item {
      cursor: pointer;
      margin-right: 33px;
      padding-right: 7px;
       font-size: 15px;
       position: relative;
   }
   .tab-planning-control-item.active::after {
       content: "";
       position: absolute;
       height: 3px;
       width: 113%;
       background: #18a689;
       bottom: -11px;
       left: -7px;
   }
   .tab-planning-content-item:not(.active){
      display: none;
   }
   #changeEcheance{
      min-width: 180px;
       font-size: 17px;
   }
</style>


</head>

<body style="-webkit-print-color-adjust: exact;">

    <div ng-app="planning" ng-controller="PlanningController" class="planning-container">
    	<input type="hidden" name="user_print" value="{{tabUserId}}">
    	<input type="hidden" name="categorie_print" value="{{categorieId}}">
       <div class="tabs-container-content">
          <div class="tabs-planning-container-list">

             <div id="timeline-toggle" class="tab-planning-content-item active">
                <div class="d-flex flex-align-center" style="justify-content: space-between;  margin-bottom: 51px;">
                   <div></div>
                   <div class="option-right" style="display: flex;">
                      <select class="form-control" id="changeEcheance" ng-model="ECHEANCE" ng-change="changeEcheance()">
                         <option value="JOURNALIERE">Jours</option>
                         <option value="TRIMESTRIELLE">Trimestres</option>
                      </select>
                      <span class="print btn btn-primary" onclick="printDiv('timeline-container')" style="background: #1ab394;margin-left: 8px;cursor: pointer;">Imprimer</span>
                   </div>
                </div>
                <div class="timeline-container" id="timeline-container">
	                
	                <div  id="ct"  class="">
	                    <table class="timeline-table">
	                      <thead class="outer">
	                         <tr>
	                            <th class="th"></th>
	                            <th colspan="[[year.sub_head.length]]" class="th_year th_year_[[year.year]]" data-year="[[year.year]]" ng-repeat="year in timelines_year track by $index">
	                               <table>
	                                  <thead class="inner">
	                                     <tr>
	                                        <td colspan="[[year.sub_head.length]]" style="font-weight: 100" ng-bind-html="year.head"></td>
	                                     </tr>
	                                     <tr  ng-if="year.echeance == 'JOURNALIERE'">
	                                        <td style="position: relative;" ng-repeat="day in year.sub_head track by $index">
	                                           <div ng-repeat="date in year.date|limitTo:1:$index">
	                                              <div class="month-bar cell-date-[[date]]" data-month="[[date]]">[[day]]</div>
	                                           </div>
	                                        </td>
	                                     </tr>
	                                     <tr ng-if="year.echeance == 'TRIMESTRIELLE'">
	                                        <td class="" style="position: relative;">
	                                           <div class="td-timel-container">
	                                              <span ng-repeat="month in year.months| limitTo:1:0" class="td-timel-container">
	                                                 <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
	                                              </span>
	                                           </div>
	                                           <span class="content-q-th">Q1</span>
	                                        </td>
	                                        <td class="" style="position: relative;">
	                                           <div class="td-timel-container">
	                                              <span ng-repeat="month in year.months| limitTo:1:1" class="td-timel-container">
	                                                 <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
	                                              </span>
	                                           </div>
	                                           <span class="content-q-th">Q2</span>
	                                        </td>
	                                        <td class="" style="position: relative;">
	                                           <div class="td-timel-container">
	                                              <span ng-repeat="month in year.months| limitTo:1:2" class="td-timel-container">
	                                                 <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
	                                              </span>
	                                           </div>
	                                           <span class="content-q-th">Q3</span>
	                                        </td>
	                                        <td class="" style="position: relative;">
	                                           <div class="td-timel-container" style="position: relative;">
	                                              <span ng-repeat="month in year.months| limitTo:1:3" class="td-timel-container">
	                                                 <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
	                                              </span>
	                                           </div>
	                                           <span class="content-q-th">Q4</span>
	                                        </td>
	                                     </tr>
	                                  </thead>
	                               </table>
	                               <span style="display: none;">[[isEndLoopMonth(timelines_year.length, $index)]]</span>
	                            </th>
	                         </tr>
	                      </thead>
	                      <tbody>
	                         <tr ng-repeat="timeline in timelines track by $index" class="timeline_user_row timeline_user_[[timeline.user.id]]" data-user=[[timeline.user.id]]>
                                    <th>
                                       <div style="display: flex;align-items: flex-start;">
                                          <div class="timeline-avatar">
                                             <img ng-src="data:image/jpeg;base64,[[timeline.user.avatar]]"
                                                class="rounded-img" ng-if="timeline.user.avatar" width="23px">
                                          </div>
                                          <div class="timeline-info-desc">
                                             <div class="prenom" style="font-weight: bold;">[[timeline.user.firstname]]</div>
                                             <div class="nom-prenom">[[timeline.user.firstname]] [[timeline.user.lastname]]</div>
                                             <div class="nom-email">[[timeline.user.email]]</div>
                                          </div>
                                       </div>
                                    </th>
                                    <td class="td-timel" colspan="[[tmln.taches.length]]" ng-repeat="tmln in timeline.timelines track by $index">
                                       <table class="table-cell">
                                          <tbody>
                                             <tr>
                                                <td class="tmln-td-body" ng-repeat="tache in tmln.taches track by $index">
                                                   <div id="[[t.identify_cell]]_[[t.id]]"  ng-repeat="t in tache track by $index" class="timeline-bar-[[timeline.user.id]] timeline-bar [[t.identify_cell]]" data-debut=[[t.debut]] data-semaine="[[tmln.data-semaine]]" data-user="[[timeline.user.id]]" data-fin=[[t.date_fin]] style="[[getPostionTimeline(t.debut, t.date_fin, t.identify_cell)]]; background: [[t.color]]" >
                                                      <div class="tooltip-timeline-bar">
                                                         <span class="nbr-day-timeline"></span>
                                                         <span class="new-date-start"></span>
                                                         <span class="new-date-end"></span>
                                                      </div>
                                                      <span class="crok-resize resizable-w">
                                                         <span>|</span>
                                                      </span>
                                                      <span>[[t.tache]]</span>
                                                      <span class="crok-resize resizable-e">
                                                         <span>|</span>
                                                      </span>
                                                   </div>
                                                </td>
                                             </tr>
                                          </tbody>
                                       </table>
                                    </td>
                                 </tr>
                           <span style="display: none;">[[isEndLoopTimeline()]]</span>
	                      </tbody>
	                   </table>
	                </div>
	            </div>

             </div>
          </div>
       </div>
    </div>


	<!-- Mainly scripts -->
	<script src="{{ asset('vendor/popper.js/dist/umd/popper.js') }}"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
	<script src="{{ asset('vendor/metisMenu/jquery.metisMenu.js') }}"></script>
	<script src="{{ asset('vendor/slimscroll/jquery.slimscroll.min.js') }}"></script>
	<script src="{{ asset('vendor/peity/jquery.peity.min.js') }}"></script>
	<script src="{{ asset('vendor/toastr/toastr.min.js') }}"></script>

	<!-- Custom and plugin javascript -->
	<script src="{{ asset('js/inspinia.js') }}"></script>
	<script src="{{ asset('vendor/pace/pace.min.js') }}"></script>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.6/xlsx.core.min.js"></script>
	<script type="text/javascript" src="{{ asset('vendor/excelplus-2.5.min.js') }}"></script>

	<!-- iCheck --> 
	<script src="{{ asset('vendor/iCheck/icheck.min.js') }}"></script>

	{% block javascript_script %}

	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://npmcdn.com/flatpickr/dist/l10n/fr.js"></script>
	<script src="{{asset('vendor/angular-lib/angular.js') }}" type="text/javascript"></script>
	<script src="{{asset('vendor/angular-lib/angular-resource.js') }}" type="text/javascript"></script>
	<script src="{{asset('vendor/angular-lib/angular-route.js') }}" type="text/javascript"></script>
	<script src="{{asset('vendor/angular-lib/angular-sanitize.min.js') }}" type="text/javascript"></script>
	<script src="{{asset('vendor/angular-lib/angular-ui-router.js') }}" type="text/javascript"></script>
	<script src="{{asset('vendor/angular-lib/underscore.js') }}" type="text/javascript"></script>
	<script src="{{asset('vendor/angular-lib/ui-bootstrap-tpls.min.js') }}" type="text/javascript"></script>
	<script src="https://code.jquery.com/ui/1.11.3/jquery-ui.min.js" integrity="sha256-xI/qyl9vpwWFOXz7+x/9WkG5j/SVnSw21viy8fWwbeE=" crossorigin="anonymous"></script>

	{% include "angular_module.html.twig" %}
	{% endblock %}
	<script type="text/javascript">
		function printDiv(divName) {
             window.print();
        }

              let pos = { top: 0, left: 0, x: 0, y: 0 };
      const ele = document.getElementsByClassName('timeline-container')[0];

      const mouseDownHandler = function(e) {
         var timelineBar = $(".timeline-bar");
         if (!timelineBar.is(e.target) && timelineBar.has(e.target).length === 0){
             pos = {
                 // The current scroll 
                 left: ele.scrollLeft,
                 top: ele.scrollTop,
                 // Get the current mouse position
                 x: e.clientX,
                 y: e.clientY,
             };
             ele.style.cursor = 'grabbing';
             ele.style.userSelect = 'none';
             document.addEventListener('mousemove', mouseMoveHandler);
             document.addEventListener('mouseup', mouseUpHandler);
         }
      };

      const mouseMoveHandler = function(e) {
          // How far the mouse has been moved
          const dx = e.clientX - pos.x;
          const dy = e.clientY - pos.y;

          // Scroll the element
          ele.scrollTop = pos.top - dy;
          ele.scrollLeft = pos.left - dx;
      };

      const mouseUpHandler = function() {
         ele.style.cursor = 'grab';
         document.removeEventListener('mousemove', mouseMoveHandler);
         document.removeEventListener('mouseup', mouseUpHandler);
      };
      ele.addEventListener('mousedown', mouseDownHandler);

      $(document).mouseup(function(e) {
          var container_user = $(".user-dropdown");
          if (!container_user.is(e.target) && container_user.has(e.target).length === 0) 
              $('.user-dropdown').css('display','none')

          var container_status = $(".menu-status");
          if (!container_status.is(e.target) && container_status.has(e.target).length === 0){ 
              $('.menu-status').removeClass('menu__active');
          }

         var editing_elt = $("input.inputTache");
         if (!editing_elt.is(e.target) && editing_elt.has(e.target).length === 0){ 
              $('input.inputTache').addClass('no-editing');
              $('input.inputTache').attr("disabled", true);
         }
         var editing_elt = $("input.inputEmplacement");
         if (!editing_elt.is(e.target) && editing_elt.has(e.target).length === 0){ 
              $('input.inputEmplacement').addClass('no-editing');
              $('input.inputEmplacement').attr("disabled", true);
         }

         var editing_elt = $(".config-planning-container");
         if (!editing_elt.is(e.target) && editing_elt.has(e.target).length === 0){ 
           $('.config-planning-container').css('display', 'none');
           $('.config-color-container').css('display', 'none');
           $('input.input-planning-name').removeClass('focus');
         }
      });
	</script>
</body>

</html>
