{% extends 'base.html.twig' %}
{% block css %}
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" type="text/css" href="{{ asset('vendor/nestable2/jquery.nestable.min.css') }}">
<script src="{{ asset('vendor/nestable2/jquery.nestable.min.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<style type="text/css">
    .dd-empty{display: none;}
    .dd{max-width: 100%}
</style>
<style type="text/css">
   .fixed-btn{
      position: fixed;
      top: 2px;
   }
  #extSubmitFixed{display: none;}
   .disable{pointer-events: none;}
   .d-flex{display: flex;}
   .flex-align-center{align-items: center;}
   .justify-content-center{justify-content: center;}
   .table {
   display: table;
   border-collapse: collapse;
   margin-bottom: 0;
   }
   .table .tr {
   display: table-row;
   border: 1px solid #fff;
   }
   .table .tr:first-child {
   font-weight: bold;
   border:0;
   }
   .table .tr:first-child > .td-cell{
   border:0;
   text-align: center;
   }
   .table .tr:first-child > .td-cell:first-child{
   text-align: left;
   }
   .table .tr:not(:first-child) {
   background-color: #f5f6f8;
   border-bottom-color: #f5f6f8;
   }
   .table .tr:nth-child(2) {
   background-color: #fff;
   border: none;
   }
   .table .tr:not(:first-child):hover {
   background: #dbdcde;
   }
   .table .tr:nth-child(2):hover {
   background: #fff;
   }
   .table .tr:nth-child(2) > .col-sort{
      cursor: pointer;
   }
   .table .tr .td-cell {
      position: relative;
   display: table-cell;
   padding: 0px 8px;
   border-left: 1px solid #fff;
   text-align: center;
   max-height: 35px;
   border-bottom: 1px solid #fff;
   }
   .table .tr .td-cell:first-child {
   border-left: 0;
   }
   .table .tr .td-cell:nth-child(2) {
   }
   /* Not necessary for table styling */
   .div-table,
   .table-tag {
   margin: 6px 2em;
   }
   .div-table .title,
   .table-tag .title {
   text-align: center;
   padding-bottom: 0.5em;
   }
   .planning-table-container{margin-bottom: 60px;display: none;}
   .list-ouvrier{
   text-align: center;
   margin: 0;
   }
   .planning-chantier-item .rounded-img {
   border-radius: 50%;
   object-fit: cover;
   }
   .list-ouvrier .rounded-img {
   cursor: pointer;
   position: relative;
   left: -5px;
   margin-left: -15px;
   width: 27px;
   height: 27px;
   }
   .list-user-dispo .rounded-img {
   width: 25px;
   min-width: 25px;
   height: 25px;
   display: flex;
   align-items: center;
   margin-right: 12px;
   }
   .list-ouvrier .avatar:hover .rounded-img{
   z-index: 4;
   }
   .list-ouvrier {
   }
   .timeline{width: 173px}
   .timeline .timeline-content{
   position: relative;
   cursor: pointer;
   color: #fff;
   padding: 1px 10px;
   border-radius: 10px;
   display: block;
   width: 124px;
   margin: auto;
   }
   .timeline .duree{display: none;}
   .timeline-content:hover .interval{
   display: none;
   }
   .timeline-content:hover .interval+.duree{
   display: block;
   }
   .td-cell-categorie{
   padding-left: 0px!important;
   padding-right: 0px!important;
   }
   .row-new-tache{
   flex: 1;
   position: relative;
   display: flex;
   align-items: stretch;
   justify-content: space-between;
   }
   .row-new-tache .col-input-new{
   flex: 1;
   padding-left: 18px;
   }
   .row-new-tache .col-input-new:focus+.btn-save-new-cat{
   display: block;
   }
   .row-new-tache .btn-save-new-cat{
   position: absolute;
   right: 0;
   display: none;
   color: #fff;
   align-items: center;
   justify-content: center;
   padding: 0 35px;
   height: 100%;
   border-radius: 0;
   }
   .btn.createPlanning{
   border: 1px solid #e6e9ef;
   color: #323338;
   }
   .timeline .timeline-content.not-date{background: #ccc!important}
   .date-range-input{
   background: transparent;
   cursor: pointer;
   width: 100%;
   position: absolute;
   left: 0;
   right: 0;
   top: 0px;
   bottom: 0px;
   color: transparent;
   border: none;
   outline: none;
   }
   .user-dropdown{
   display: none;
   background: #fff;
   border-radius: 8px;
   padding: 15px 8px;
   position: absolute;
   top: 40px;
   z-index: 500;
   width: 270px;
   box-shadow: 0px 0px 6px 1px rgb(0 0 0 / 7%);
   }   

   .status-dropdown{
   display: none;
   background: #fff;
   padding: 14px 0 9px;
   position: absolute;
   top: 44px;
   z-index: 10;
   width: 270px;
   box-shadow: 0px 0px 6px 1px rgb(0 0 0 / 7%);
   }
   .carret{
     width: 0;
     height: 0;
     border-style: solid;
     border-width: 0px 8px 6px 8px;
     border-color: transparent transparent #fff transparent;
     position: absolute;
   }
   .carret.carret-dropdown-status{
   top: -6px;
   }
   .user-dropdown .list-select-user >*{
   background: #e5f4ff !important;
   color: #000;
   padding: 5px 20px 5px 3px;
   border-radius: 5px;
   font-size: 7px;
   margin-right: 3px;
   margin-bottom: 4px;
   }
   .filter-user{
   width: 100%;
   outline: none;
   border: none;
   margin: 16px 0px 13px;
   }
   .list-user-dispo{
   list-style: none;
   margin: 0;
   text-align: left;
   font-size: 13px;
   margin-top: 12px;
   padding: 0 4px 0;
   /*max-height: 209px;
   overflow: hidden;*/
   }
   .list-user-dispo >*{
   cursor: pointer;
   padding: 5px 6px;
   border-radius: 5px;
   font-size: 12px;
   }
   .list-user-dispo >*:not(:last-child){
   margin-bottom: 0;
   }
   .list-user-dispo >*:hover{
   /*background: rgb(202, 182, 65);*/
   color: #fff;
   }
   .table .tr:first-child > .td-cell.td-cell-personne{
   width: 270px;
   }
   .user-dropdown .line{
   height: 1px;
   background: #ccc;
   flex: 0.3;
   }
   .footer{display: none;}
   .remove-user {
   cursor: pointer;
   position: absolute;
   right: 0px;
   transform: translateY(-50%);
   top: 50%;
   font-size: 13px;
   padding: 2px 5px;
   line-height: 1;
   border-radius: 50%;
   }
   .remove-user:hover{
   background: #fff;
   }
   /* status menu */
   .menu-status {
   position: relative;
   width: 17rem;
   font-size: 1.2rem;
   font-weight: bold;
   color: #687F98;
   background-color: white;
   transition: transform 0.4s cubic-bezier(0.28, 0.25, 0.36, 1.28);
   cursor: pointer;
   color: #fff;
   margin: auto;
   height: 35px;
   display: flex;
   align-items: center;
   justify-content: center;
   }
   .menu__icon-box {
   width: 1rem;
   height: 1rem;
   margin-top: -0.3rem;
   }
   .menu__icon {
   width: 1rem;
   height: 1rem;
   border-top: 0.15rem solid #687F98;
   border-right: 0.15rem solid #687F98;
   transition: all 0.3s ease-in-out;
   transform: rotate(135deg);
   }
   .menu__dropdown {
   width: 17rem;
   font-weight: lighter;
   position: absolute;
   top: 4rem;
   opacity: 0;
   display: none;
   z-index: 2;
   }
   .menu__dropdown-option {
   padding: 0.8rem 1.6rem;
   }
   .menu__dropdown-option:hover {
   background-color: #E8F0FC;
   }
   .menu__active {
   }
   .menu__active .menu__icon {
   transform: rotate(-45deg);
   margin-top: 0.5rem;
   }
   .menu__active .menu__dropdown {
   opacity: 1;
   display: block;
   animation: showDropdownMenu 0.4s cubic-bezier(0.28, 0.25, 0.36, 1.28);
   }
   @keyframes showDropdownMenu {
   0% {
   opacity: 0;
   transform: translateY(-2rem);
   }
   100% {
   opacity: 1;
   transform: translateY(0rem);
   }
   }
   .filter-td{
   display: flex;
   align-items: center;
   flex-direction: column;
   justify-content: center;
   font-size: 11px;
   border-radius: 50%;
   width: 23px;
   height: 22px;
   color: #fff;
   cursor: pointer;
   }   
   .dropdown-config-planning{
    display: flex;
    align-items: center;
    flex-direction: column;
    justify-content: center;
    font-size: 8px;
    border-radius: 50%;
    width: 15px;
    height: 15px;
    color: #fff;
    cursor: pointer;
    margin-bottom: 5px;
    background: rgb(196, 196, 196);
   }
   .config-planning-container {
    display: none;
    background: #fff;
    border-radius: 8px;
    padding: 16px 0;
    position: absolute;
    top: 32px;
    color: #323338;
    left: 7px;
    text-align: left;
    z-index: 9999;
    width: 301px;
    box-shadow: 0px 0px 6px 1px rgb(0 0 0 / 15%);
    font-size: 14px;
   }
   .config-planning-container .config-color{
   width: 13px;
   height: 13px;
   display: inline-block;
   border-radius: 50%;
   background: rgb(196, 196, 196);
   }
   .config-planning-container .config-item{cursor: pointer;padding:0 18px;}
   .config-planning-container .config-item:not(:last-child) {
    margin-bottom: 12px;
   }
   .config-planning-container .config-text {
   margin-left: 7px;
   }
   .dropdown-config-planning .config-text {
    margin-left: 7px;
   }

   .dropdown-config-planning:after {
   content: '\25bc';   
   } 
   .filter-td > .fa{
   line-height: 0.7;
   }
   .filter-td.asc > .desc{
   color: #b3b3b3;
   }
   .filter-td.desc > .asc{
   color: #b3b3b3;
   }
   .sortorder:after {
   content: '\25b2';   
   }
   .sortorder.reverse:after {
   content: '\25bc';   
   }   
   .table .tr:hover .ds-menu-button-container{
   opacity: 1;
   }
   .pulse-menu-component {
   align-items: center;
   background-color: #ffffff !important;
   background-color: var(--primary-background-color) !important;
   display: flex;
   flex: 0 0 30px;
   justify-content: center;
   max-width: 30px;
   z-index: 1;
   }
   .pulse-menu-component:before {
   content: "";
   height: 100%;
   width: 16px;
   position: absolute;
   left: -16px;
   background-color: #ffffff;
   background-color: var(--primary-background-color);
   }
   .pulse-menu-component .ds-menu-button-container {
   opacity: 0;
   }
   .ds-menu-button.ds-menu-button-sm {
   width: 18px;
   height: 18px;
   font-size: 15px;
   border-radius: 4px;
   display: flex;
   justify-content: center;
   align-items: center;
   cursor: pointer;
   background-color: #e6e9ef;
   }
   .td-cell.col-action{
   background: #fff; width: 36.3px
   }
   .toggle-user .user-empty{
   position: relative;
   top: 6px;
   }
   input.no-editing{
   cursor: default;
   border: none;
   background: none;
   }
   .inputTache, .inputEmplacement{
   padding-left: 10px;
   width: 100%;
    min-height: 100%;
    position: absolute;
    top: 0px;
    right: 0;
    left: 0;
    color: #323338;
    padding-left: 17px;
   }
   .status-container .list-status{
   padding: 0 14px;
   display: flex;
   flex-wrap: wrap;
   justify-content: space-between; 
   }
   .status-container .list-status .status-item{
   background: rgb(202, 182, 65);
   width: 117px;
   margin-bottom: 6px;
   height: 32px;
   display: flex;
   align-items: center;
   justify-content: center;
   }
   .status-container .row-edit{
   color: #0085ff;
   font-weight: 100;
   border-top: 1px solid #adadad;
   margin-top: 15px;
   padding: 11px 0 1px;
   font-size: 13px;
   margin-top: 35px;
   }
   .config-color-container {
   display: none;
   position: absolute;
   top: 0px;
   z-index: 9;
   left: 0;
   }
   .color-selected{
   background: #fff;
   margin: 0;
   position: absolute;
   left: 0;
   top: 1px;
   padding: 0;
   border: 1px solid #c5c7d0;
   display: flex;
   align-items: center;
   justify-content: center;
   width: 35px;
   height: 34px;
   border-bottom: none;
   border-radius: 50% 50% 0 0;
   }
   .config-color-container .list-color-config {
   background: #fff;
   border: 1px solid #c5c7d0;
   padding: 7px 5px;
   width: 142px;
   display: flex;
   justify-content: start;
   flex-wrap: wrap;
   margin-top: 34px;
   }
   .list-color-config .color-item, .color-selected .color-item {
    width: 19px;
    height: 19px;
    display: inline-block;
    border-radius: 50%;
    margin-right: 6px;
    margin-bottom: 7px;
   }
   .input-planning-name{padding: 6px 12px 6px 0}
   .input-planning-name.focus{width: calc( 100% - 35px );}
   .dropdown-tache-config{
   width: 301px;
   color: #323338;
   font-size: 14px;
   }
   .dropdown-tache-config .icon-left-row{
   margin-right: 5px;
   }
   .dragable-container {
   display: none;
   border-radius: 4px 0 0 4px;
   cursor: pointer;
   background: #e6e9ef;
   transition: background 0.1s ease;
   margin-left: 36.3px;
   }
   .dragable-container > .dragable-container-content{
   padding-left: 8px;
   position: relative;
   min-height: 40px;
   font-size: 18px;
   font-weight: 100;
   display: flex;
   justify-content: space-between;
   align-items: center;
   padding: 0 11px;
   }
   .dragable-container:hover .planning-nom {
   padding-left: 5px;
   }
   .dragable-container:hover .expanded-btn-open {
   display: flex;
   }
   .dragable-container > .dragable-container-content > *{
   display: flex;
   align-items: center;
   }
   .expanded-btn-open{
   display: none;
   font-size: 12px;
   background: #d9d9d9;
   width: 20px;
   height: 20px;
   border-radius: 50%;
   align-items: center;
   justify-content: center;
   }
   .dragable-container .planning-nom{
   transition: linear padding-left .1s;
   }
   .profile-item{
   display: none;
   background: #fff;
   border-radius: 9px;
   box-shadow: 0px 0px 6px 1px rgb(0 0 0 / 7%);
   width: 324px;
   position: absolute;
   left: 0;
   right: 0;
   margin: auto;
   top: -93px;
   z-index: 10;
   }
   .profile-item-content {
   display: flex;
   align-items: flex-start;
   padding: 16px 19px;
   }
   .profile-img > img{
   width: 75px;
   height: 75px;
   object-fit: cover;
   border-radius: 50%;
   }
   .profile-info-desc {
   text-align: left;
   margin-left: 26px;
   line-height: 22px;
   }
   .profile-info-desc .prenom{
   color: #525252;
   font-weight: 600;
   font-size: 16px;
   margin-bottom: 4px;
   }
</style>



<style type="text/css">
   .timeline-container::-webkit-scrollbar {
       width: 1.1rem;
   }
   *::-webkit-scrollbar-track {
       background-color: #edf2f7;
   }
   *::-webkit-scrollbar-thumb {
       background-color: #718096;
       border-radius: 9999px;
   }
   .timeline-container {
       scrollbar-width: thin;
       /* The color of thumb and track areas */
       scrollbar-color: #718096 #edf2f7;
   }
   .timeline-container{
      cursor: grab;
      overflow: auto;
      /*height: 100vh;*/
   }
   td, th{
   height: 100px;
   min-width: 232px;
   }
   table {
   white-space: nowrap;
   margin: 0;
   border: none;
   border-collapse: separate;
   border-spacing: 0;
   table-layout: fixed;
   }
   .timeline-table td{
   border: 1px solid #dedede; 
   border-left: none; 
   }
   .timeline-table tbody td, .timeline-table tbody th{
   border-top: none;
   }
   .timeline-table thead.inner th:first-child{border-bottom: none;}
   .timeline-table .outer > tr > th:first-child, .timeline-table tbody th:first-child{
   border-right: 1px solid #a5a6a8;
   }
   .timeline-table thead.inner tr:first-child td{
   border-bottom: none;
   font-size: 17px;
   }
   tbody th:first-child{border-bottom: 1px solid #dedede;}
   thead.inner tr:nth-child(1) td {
   font-weight: bold;
   }
   tr > th:first-child{
      display: flex;
      align-items: flex-start;
      padding: 7px 12px 9px 7px;
      border-left: 1px solid #dedede;
      border-top: none;
      width: 257px;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      font-size: 13px;
      z-index: 100;
   }
   thead.outer > tr >th, thead.inner td {
   height: 45px;
   font-size: 11px;
   color: #4e4f52;
   font-weight: 300;
   }
   table td, table th {
   padding: 0.5rem 1rem;
   }
   table thead tr > th {
   padding: 0;
   position: sticky;
   top: 0;
   z-index: 1;
   background: white;
   z-index: 200;
   }
   table td {
   background: #fff;
   /*padding: 4px 5px;*/
   padding: 0;
   text-align: center;
   }
   table tbody th {
   font-weight: 100;
   position: relative;
   }
   table thead th:first-child {
   position: sticky;
   left: 0;
   z-index: 201;
   height: 90px;
   }
   table tbody th {
      position: sticky;
      left: 0;
      background: white;
      z-index: 1;
   }
   .timeline-avatar > img {
      width: 37px;
      height: 37px;
      object-fit: cover;
      border-radius: 50%;
   }
   .timeline-info-desc {
      text-align: left;
      margin-left: 11px;
      line-height: 22px;
   }
   tbody .table-cell{height: 100px;}
   tbody .td-timel{
      padding: 0;
      border:none;
   }
   .timeline-container tbody td{
      position: relative;
   }
   .timeline-bar {
      z-index: 10;
      border-radius: 3px;
      position: absolute;
      left: 56px;
      width: 50px;
      height: 30px;
      background: rgb(255, 21, 138);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grabbing;
      top: 40px;
   }
   .timeline-bar:hover .crok-resize{
      display: inline-flex;
   }
   .timeline-bar .crok-resize{
       position: absolute;
       display: none;
       background: #5f5f5f;
       color: #fff;
       padding: 1px 1px;
       top: 0;
       bottom: 0;
       align-items: center;
       justify-content: center;
   }
   .timeline-bar .crok-resize.resizable-w{
      left: -6px;
      border-radius: 3px 0 0 3px;
   }
   .timeline-bar .crok-resize.resizable-e{
      right: -6px;
      border-radius: 0 3px 3px 0;
   }
   .td-timel-container .month-bar {
      height: 100%;
       display: inline-block;
       flex: 1;
   }
   .td-timel-container {
       height: 100%;
       width: 100%;
       display: flex;
       justify-content: space-between;
   }
   .content-q-th{
      position: absolute;
      top: 50%;
      bottom: 50%;
      left: 0;
      right:0;
      margin: auto;
      transform: translateY(-50%);
   }
   .timeline-bar:hover {
      min-width: 80px;
   }
   .tooltip-timeline-bar {
      background: #000000c2;
      height: 12px;
      position: absolute;
      left: 0;
      right: 0;
      margin: auto;
      top: -35px;
      height: 100%;
      display: none;
      justify-content: space-between;
      align-items: center;
      padding: 0 11px;
      border-radius: 3px;
      font-size: 14px;
   }
   .nbr-day-timeline{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: #000;
      font-size: 16px;
      font-weight: 400;
   }
   .rounded-img {
       border-radius: 50%;
       position: relative;
       left: -5px;
       z-index: 1;
       width: 40px;
       height: 40px;
       object-fit: cover;
       transition: easy 0.4s all;
   }
   .td-cell.timeline:hover .clearDate{
      display: inline-block;
   }
   .clearDate {
      display: none;
       position: absolute;
       right: 3px;
       top: 50%;
       transform: translateY(-50%);
       background: #ccc;
       color: #fff;
       height: 16px;
       width: 16px;
       font-size: 11px;
       line-height: 1;
       border-radius: 50%;
       cursor: pointer;
   }
   .clearDate:hover{
      background: #888;
   }


   .tabs-planning-control-list {
       display: flex;
       margin-bottom: 20px;
       margin-top: 38px;
       margin-left: 22px;
       border-bottom: 1px solid #e8e8e8;
       padding-bottom: 9px;
   }
   .tab-planning-control-item {
      cursor: pointer;
      margin-right: 33px;
      padding-right: 7px;
       font-size: 15px;
       position: relative;
   }
   .tab-planning-control-item.active::after {
       content: "";
       position: absolute;
       height: 3px;
       width: 113%;
       background: #18a689;
       bottom: -11px;
       left: -7px;
   }
   .tab-planning-content-item:not(.active){
      display: none;
   }
   #changeEcheance{
      min-width: 180px;
       font-size: 17px;
   }
</style>
{% endblock %}
{% block breadcrumb %}
<div class="row wrapper border-bottom white-bg page-heading">
   <div class="col-lg-10">
      <h1>Planning</h1>
      <ol class="breadcrumb">
         <li class="breadcrumb-item">
            <a href="{{ path('home') }}">Accueil</a>
         </li>
         <li class="breadcrumb-item active">
            <strong>Planning</strong>
         </li>
      </ol>
   </div>
</div>
{% endblock %}
{% block content %}
<div class="row">
   <div class="col-lg-12">
      {% include 'flashes.html.twig' %}
      <div class="ibox ">
         <div class="ibox-content">
            <div ng-app="planning" ng-controller="PlanningController" class="planning-container">
               
               <div class="tabs-planning-control-list">
                  <div class="tab-planning-control-item active" ng-click="switchModeDisplay($event, 'table')" data-tabs="table-toggle">
                     <i class="fa fa-table" aria-hidden="true" style="margin-right: 6px"></i> 
                     Par défaut
                  </div>
                  <div class="tab-planning-control-item" ng-click="switchModeDisplay($event, 'timeline')" data-tabs="timeline-toggle">
                     <i class="fa fa-bars" aria-hidden="true" style="margin-right: 6px"></i>Timeline
                  </div>
               </div>

               <div class="tabs-container-content">
                  <div class="tabs-planning-container-list">
                     <div id="table-toggle" class="tab-planning-content-item active">
                        
                        <div class="planning-table-show">
                           <div style="display: flex;align-items: center; justify-content: flex-end;margin-bottom: 36px;">
                              <span class="btn createPlanning" ng-class="loadingPlanning ? 'disable' : ''" ng-click="createPlanning()">+ Nouveau Planning</span>

                              <div class="dropdown" style="margin-left: 5px;">
                                <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                  Imprimer
                                  <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                  <li><a href="{{path('planning_print_list')}}" target="_blank">Tout</a></li>
                                  <li>
                                    <a data-toggle="modal"  href="javascript:void()" data-target="#modalUser" style="cursor: pointer;" >Individuelle</a>
                                 </li>
                                </ul>
                              </div>
                           </div>
                           <div class="planning-chantier-list">
                              <div class="div-table planning-chantier-item" ng-repeat="planning in plannings track by $index">
                                  <div class="dragable-container" id="dragable-container-[[planning.categorie_id]]" ng-click="collapsePlanning('open', planning.categorie_id, $event)"
                                  ng-style='planning.collapse && {"display": "block"}'
                                  >
                                    <div class="dragable-container-content">
                                      <div>
                                        <span class="expanded-btn-open" >
                                          <i class="fa fa-arrows-v" aria-hidden="true"></i>
                                        </span>
                                        <span class="planning-nom" style="color: [[planning.categorie_color]]">
                                          [[planning.categorie]]
                                        </span>
                                      </div>
                                      <div>
                                        <span style="font-size: 12px; color: [[planning.categorie_color]]">
                                          [[planning.taches.length]] Elements
                                        </span>
                                      </div>
                                    </div>
                                  </div>

                                   <div class="planning-table-container" id="table-container-[[planning.categorie_id]]" ng-style='!planning.collapse && {"display": "block"}'>
                                      <div class="table"  id="simpleList-[[planning.categorie_id]]">
                                        <div class="tr static-drop">
                                            <div class="td-cell"></div>
                                            <div class="td-cell"></div>
                                            <div class="td-cell" ng-click="sortBy('date_debut_strtotime')">
                                               <div style="display: flex;justify-content: center;">
                                                  <span class="filter-td sortorder" ng-show="propertyName === 'date_debut_strtotime'" ng-class="{reverse: reverse}" style="background: [[planning.categorie_color]]">
                                                  </span>
                                               </div>
                                            </div>
                                            <div class="td-cell">
                                            </div>
                                            <div class="td-cell"></div>
                                            <div class="td-cell col-sort" ng-click="sortBy('diffDay')">
                                               <div style="display: flex;justify-content: center;">
                                                  <span class="filter-td sortorder" ng-show="propertyName === 'diffDay'" ng-class="{reverse: reverse}" style="background: [[planning.categorie_color]]">
                                                  </span>
                                               </div>
                                            </div>
                                         </div>
                                         <div class="tr ">
                                            <div class="td-cell col-action" style="position: relative;">
                                               <span class="dropdown-config-planning" ng-click="dropdownConfigPlanning($event)" style="background: [[planning.categorie_color]]">
                                               </span>
                                               <div class="config-planning-container">
                                                  <div class="list-config">
                                                     <div class="config-item">
                                                        <span>
                                                          <i class="far fa-compress-alt" style="transform: rotate(-45deg);"></i>
                                                        <span class="config-text" ng-click="collapsePlanning('close', planning.categorie_id)">Reduire ce groupe</span>
                                                     </div>
                                                     <div class="config-item">
                                                        <span>
                                                          <i class="far fa-compress-alt" style="transform: rotate(-45deg);"></i>
                                                        </span>
                                                        <span class="config-text" ng-click="collapsePlanning('close', 0)">Reduire tout les groupes</span>
                                                     </div>
                                                     <div class="config-item">
                                                        <span>
                                                          <i class="fas fa-print"></i>
                                                        </span>
                                                        <span class="config-text" ng-click="openUserList('planning_categorie', planning.categorie_id)">Imprimer ce groupe</span>
                                                     </div>
                                                     <div class="config-item">
                                                        <span>
                                                          <i class="fas fa-print"></i>
                                                        </span>
                                                        <span class="config-text" ng-click="openUserList('planning_categorie_individuel', planning.categorie_id)">Impression individuelle</span>
                                                     </div>
                                                     
                                                     <div class="config-item">
                                                        <span>
                                                          <i class="fas fa-print"></i>
                                                        </span>
                                                        <span class="config-text" ng-click="openUserList('timeline_categorie', planning.categorie_id)">Impression timeline</span>
                                                     </div>
                                                     <div class="config-item">
                                                        <span>
                                                          <i class="fas fa-print"></i>
                                                        </span>
                                                        <span class="config-text" ng-click="openUserList('timeline_categorie_individuel', planning.categorie_id)">Impression timeline individuel</span>
                                                     </div>
                                                     <!--div class="config-item">
                                                        <span>
                                                          <i class="fas fa-print"></i>
                                                        </span>
                                                        <a href="{{path('planning_print_timeline')}}" class="config-text" ng-click="openUserList('timeline_categorie', planning.categorie_id)">Impression timeline</a>
                                                     </div>-->
                                                     <hr>
                                                     <div class="config-item">
                                                        <i class="fa fa-pencil"></i>
                                                        <span class="config-text">Renommer ce groupe</span>
                                                     </div>
                                                     <div class="config-item">
                                                        <span class="config-color" style="background: [[planning.categorie_color]]"></span>
                                                        <span class="config-text" ng-click="editConfigColor(planning.categorie_id)">Modifier la couleur du groupe</span>
                                                     </div>
                                                     <hr>
                                                     <div class="config-item">
                                                        <i class="fa fa-trash"></i>
                                                        <span class="config-text" ng-click="deletePlanning(planning.categorie_id)">Supprimer</span>
                                                     </div>
                                                     <div class="config-item">
                                                        <i class="fa fa-archive"></i>
                                                        <span class="config-text" ng-click="archivePlanning(planning.categorie_id)">Archive</span>
                                                     </div>
                                                  </div>
                                               </div>
                                            </div>
                                            <div class="td-cell td-categorie col-sort" style="position: relative; padding: 0; border-left: none;display: flex;justify-content: flex-end;">
                                                <span class="expanded-btn-open" style="/*display: flex;*/margin-right: 5px;">
                                                  <i class="fa fa-arrows-v" aria-hidden="true"></i>
                                                </span>
                                               <select ng-model="planning.categorie" ng-change="changeCategory(planning.categorie_id)" class="form-control" id="categorie_id_[[planning.categorie_id]]" ng-if="planning.new_created">
                                                  <option data-chantier-nom="[[chantier.nom]]" ng-repeat="chantier in chantiers track by $index" value="[[chantier.id]]" ng-selected="chantier.id == planning.chantier_id">
                                                     [[chantier.nom]]
                                                  </option>
                                               </select>
                                               <input ng-if="!planning.new_created" id="categorie_id_[[planning.categorie_id]]" type="text" class="form-control input-planning-name" value="[[planning.categorie]]" style="pointer-events: none;border: none;">
                                               <div class="config-color-container" data-planning-id="[[planning.categorie_id]]">
                                                  <span class="color-selected">
                                                    <span class="color-item" style="margin: 0; background: [[planning.categorie_color]]"></span>
                                                  </span>
                                                  <div class="list-color-config">
                                                     <a class="color-item" style="background: [[color]];" ng-repeat="color in planningConfigColor" ng-click="changePlanningConfigColor(planning.categorie_id, color)"></a>
                                                  </div>
                                               </div>
                                            </div>
                                            <div class="td-cell col-sort" ng-click="sortBy('date_debut_strtotime')">
                                               <span>Timeline</span>
                                            </div>
                                            <div class="td-cell td-personne" style="padding: 0px 10px">Personnes</div>
                                            <div class="td-cell td-emplacement">
                                               Devis
                                            </div>
                                            <div class="td-cell td-emplacement">
                                               Emplacement
                                            </div>
                                            <div class="td-cell">Status</div>
                                            <div class="td-cell">Nb jour</div>
                                         </div>
                                         <div ng-repeat="tache in planning.taches | orderBy:propertyName:reverse track by $index"  data-categorie="[[planning.categorie_id]]" class="tr dd-item" data-tache-id="[[tache.id]]">
                                             <div class="td-cell col-action dropdown">
                                                <div class="pulse-menu-component dropdown-toggle" type="button" id="dropdownMenu[[tache.id]]" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                   <div class="ds-menu-button-container">
                                                      <div class="ds-menu-button ds-menu-button-sm  null"><i class="fa fa-caret-down"></i></div>
                                                   </div>
                                                </div>
                                                <ul class="dropdown-menu dropdown-tache-config" aria-labelledby="dropdownMenu[[tache.id]]">
                                                   <li>
                                                     <a href="javascript:void()" ng-click="editTache(tache.id)"><i class="fa fa-pencil icon-left-row"></i> Modifier</a>
                                                   </li>
                                                   <li role="separator" class="divider"></li>
                                                   <li>
                                                      <a href="javascript:void()" ng-click="deleteTache(planning.categorie_id, tache.id)"><i class="fa fa-trash icon-left-row"></i> Supprimer</a>
                                                    </li>
                                                </ul>
                                             </div>
                                             <div class="td-cell tache-name" style="position: relative;">
                                               <input type="text" data-categorie=[[planning.categorie_id]] data-id-tache=[[tache.id]] id="editing-[[tache.id]]" class="inputTache no-editing" value="[[tache.tache]]" disabled name="" style="width: 100%; box-shadow: inset 7px 0px 0px 0px [[planning.categorie_color]]">
                                             </div>
                                             <div class="td-cell timeline">
                                                <span class="clearDate" ng-click="clearDate(planning.categorie_id, tache.id)" ng-hide="!tache.dateInterval">x</span>
                                                <span class="timeline-content" id="tache-input-date-container[[tache.id]]" ng-class="!tache.dateInterval ? 'not-date' : ''" style="background: [[planning.categorie_color]]" ng-click="selectDate(tache.id, $event)" data-date-to-calendar="[[tache.dateCalendar]]">
                                                   <input style="z-index: -1" id="tache_date[[tache.id]]" type="text" class="date-range-input flatpickr-input" data-planning-id="[[planning.categorie_id]]" data-tache-id="[[tache.id]]" value="[[tache.dateInterval]]" data-date-to-calendar="[[tache.dateCalendar]]">
                                                   <span ng-hide="!tache.dateInterval">
                                                      <span class="interval">
                                                      [[tache.dateInterval]]
                                                      </span>
                                                      <span class="duree">
                                                      [[tache.diffDay]]d
                                                      </span>
                                                   </span> 

                                                   <span  ng-show="!tache.dateInterval">
                                                      <span class="interval">
                                                      -
                                                      </span>
                                                      <span class="duree">
                                                      definir date
                                                      </span>
                                                   </span> 
                                                </span>

                                             </div>
                                             <div class="td-cell" style="position: relative;     min-width: 170px;">
                                                <div class="toggle-user" ng-click="dropdownUsers(tache.id)">
                                                   <ul class="list-ouvrier list-inline" ng-if="tache.users.length > 0">
                                                      <li class="avatar user-profile-avatar" data-user-id="[[usr.id]]" data-tache-id="[[tache.id]]" ng-repeat="usr in tache.users| orderBy:'lastname' track by $index">
                                                         <img ng-src="data:image/jpeg;base64,[[usr.avatar]]"
                                                            class="rounded-img" ng-if="usr.avatar != ''" style="border: 1px solid [[planning.categorie_color]]">
                                                      </li>
                                                   </ul>
                                                   <div class="profile-item user-profile-[[tache.id]]-[[usr.id]]" ng-repeat="usr in tache.users track by $index">
                                                      <div class="profile-item-content">
                                                        <div class="profile-img">
                                                          <img ng-src="data:image/jpeg;base64,[[usr.avatar]]">
                                                        </div>
                                                        <div class="profile-info-desc">
                                                          <div class="prenom">[[usr.firstname]]</div>
                                                          <div class="nom-prenom">[[usr.firstname]] [[usr.lastname]]</div>
                                                          <div class="email">[[usr.email]]</div>
                                                        </div>
                                                      </div>
                                                    </div>
                                                   <span class="user-empty">
                                                   <i class="fas fa-user-circle" ng-if="!tache.users.length" style="cursor: pointer; font-size: 26px;color: #888;"></i>
                                                   </span>
                                                </div>
                                                <div class="user-dropdown user-dropdown-[[tache.id]]">
                                                   <ul class="list-inline list-select-user text-left" style="margin: 0">
                                                      <li ng-repeat="user in tache.users| orderBy:'lastname' track by $index" style="position: relative;">
                                                         <span class="d-flex flex-align-center">
                                                         <img  width="20px" height="20px" ng-src="data:image/jpeg;base64,[[user.avatar]]"
                                                            class="rounded-img" ng-if="user.avatar">
                                                         <i class="rounded-img fas fa-user-circle" ng-if="!user.avatar" style="cursor: pointer; font-size: 26px;color: #888;"></i>
                                                         <span style="margin-left: 3px"> 
                                                         [[user.lastname]] [[user.firstname]]
                                                         </span>
                                                         </span>
                                                         <span class="remove-user" ng-click="removeUser(planning.categorie_id, tache.id, user.id)">x</span>
                                                      </li>
                                                   </ul>
                                                   <input type="text" class="filter-user" ng-model="search.full_name" name="" placeholder="Entrer un email ou nom">
                                                   <div class="d-flex flex-align-center justify-content-center">
                                                      <span class="line"></span>
                                                      <span style="padding: 0 2px">Personne</span>
                                                      <span class="line"></span>
                                                   </div>
                                                   <style type="text/css">
                                                      .list-user-dispo-[[planning.categorie_id]]>*:hover{
                                                        background: [[planning.categorie_color]];
                                                     }
                                                   </style>
                                                   <ul class="list-user-dispo list-user-dispo-[[planning.categorie_id]]">
                                                      <li ng-repeat="user in tache.utilisateurs_dispo | orderBy:'lastname' | filter:search track by $index">
                                                         <span class="d-flex flex-align-center" ng-click="addUser(planning.categorie_id, tache.id, user.id, user.avatar, user.firstname, user.lastname, user.email)">
                                                         <img ng-src="data:image/jpeg;base64,[[user.avatar]]"
                                                            class="rounded-img" ng-if="user.avatar">
                                                         <i class="rounded-img fas fa-user-circle" ng-if="!user.avatar" style="cursor: pointer; font-size: 26px;color: #888;"></i>
                                                         <span>[[user.full_name]]</span>
                                                         </span>
                                                      </li>
                                                   </ul>
                                                </div>
                                             </div>

                                             <div class="td-cell" style="position: relative;     min-width: 80px;">

                                                <div class="dropdown" ng-if="planning.devis_chantier.length">
                                                  <span id="dLabel" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor: pointer;">
                                                   <span ng-if="tache.devis_planning">[[tache.devis_planning]]</span>
                                                   <span ng-if="!tache.devis_planning">--Selectionner un devis--</span>
                                                    
                                                    <span class="caret"></span>
                                                  </span>
                                                  <ul class="dropdown-menu" aria-labelledby="dLabel">
                                                      <li ng-repeat="dv in planning.devis_chantier" style="border-bottom: 1px solid #e5e5e5;">
                                                         <a href="javascript:void()" ng-click="changeDevis(planning.categorie_id, tache.id, dv.id)">[[dv.to_string]]</a>
                                                      </li>
                                                  </ul>
                                                </div>
                                             </div>

                                             <div class="td-cell td-editable tache-emplacement" style="position: relative;">
                                                <input type="text" data-categorie=[[planning.categorie_id]] data-id-tache=[[tache.id]] id="editing-[[tache.id]]" class="inputEmplacement no-editing" value="[[tache.emplacement]]" disabled name="" style="width: 100%;">
                                             </div>
                                             <div class="td-cell">
                                                <div class="menu-status menu-status-[[tache.id]]" id="menu-status-[[tache.id]]" ng-style='tache.status.id && {"background": "[[tache.status.color]]"} || !tache.status.id && {"background": "#DAD8A7"}' ng-click="changeStatus($event, planning.categorie_id, tache.id)">
                                                   <span class="select-status" ng-if='tache.status.id'>[[tache.status.nom]]</span>
                                                   <span class="select-status" ng-if='!tache.status.id'>
                                                   Status
                                                   </span>
                                                   <div class="menu__icon-box" style="display: none;">
                                                      <div class="menu__icon"></div>
                                                   </div>
                                                   <div class="menu__dropdown">
                                                      <div class="menu__dropdown-option" ng-repeat="status in statusPlanning track by $index" style="background: [[status.color]]" data-status-id="[[status.id]]" data-status-color="[[status.color]]">
                                                         [[status.nom]]
                                                      </div>
                                                   </div>
                                                </div>

                                                  <div class="menu-status menu-status-[[tache.id]]" id="menu-status-[[tache.id]]" ng-style='tache.status.id && {"background": "[[tache.status.color]]"} || !tache.status.id && {"background": "#DAD8A7"}' ng-click="dropdownStatus(tache.id)" style="position: relative;display: none;">
                                                     <span class="select-status" ng-if='tache.status.id'>[[tache.status.nom]]</span>
                                                     <span class="select-status" ng-if='!tache.status.id'>
                                                     Status
                                                     </span>

                                                     <div class="status-dropdown status-dropdown-[[tache.id]]"> <span class="carret carret-dropdown-status"></span>
                                                      
                                                      <div class="status-container">
                                                        <div class="list-status">
                                                          <div class="status-item">En attente</div>
                                                          <div class="status-item">En cours</div>
                                                          <div class="status-item">Terminé</div>
                                                          <div class="status-item">Livré</div>
                                                          <div class="status-item">En attente</div>
                                                          <div class="status-item">En cours</div>
                                                          <div class="status-item">Terminé</div>
                                                          <div class="status-item">Livré</div>
                                                        </div>
                                                      </div>
                                                      <div class="row-edit">
                                                          <i class="fa fa-pencil" aria-hidden="true"></i>&nbsp<span>Edition</span>
                                                      </div>
                                                    </div>
                                                  </div>
                                                  
                                             </div>
                                             <div class="td-cell">[[tache.diffDay]]</div>
                                         </div>
                                      </div>
                                     <div style="display: flex;align-items: center;justify-content: center;">
                                        <div class="small-fixed-width" style="width: 36.3px;"></div>
                                       <form ng-submit="submitCategory($event, planning.categorie_id)" class="row-new-tache" class="form-[[planning.categorie_id]]">
                                           <input type="text" id="planning_input[[planning.categorie_id]]" class="form-control col-input-new" placeholder="+ Nouvelle tache">
                                           <input class="btn btn-save-new-cat" type="submit" id="submit_[[planning.categorie_id]]" value="Enregister" style="background:  [[planning.categorie_color]]" />
                                       </form>
                                     </div>
                                   </div>
                                    <div id="modalUserPlanning-[[planning.categorie_id]]" class="modal fade modalUserPlanning" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                       <div class="modal-dialog" role="document">
                                          <div class="modal-content">
                                            <div class="modal-header">
                                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                              <h2 class="modal-title text-center" id="myModalLabel">Choisissez un utilisateur</h2>
                                            </div>
                                            <div class="modal-body" style="padding-top: 0">
                                                  <form method="POST" id="modalPlannifiedForm" class="modalPlannifiedForm-[[planning.categorie_id]]" action="" target="_blank">
                                                      <input type="hidden" name="planningId" value="[[planning.categorie_id]]">
                                                      <div class="entreprise-list list-user form-group" style="margin-top: 0">
                                                          <div ng-repeat="user in planning.user_planified track by $index">
                                                            <input id="[[planning.categorie_id]]-[[user.id]]" type="checkbox" name="user[]" value="[[user.id]]" style="display: none;" class="user-planified">
                                                              <label for="[[planning.categorie_id]]-[[user.id]]" class="switch-entreprise entreprise-item" style="cursor: pointer; justify-content: flex-start; align-items: flex-start; border-radius: 20px 5px 5px 24px;">
                                                                  <span style="margin-right: 16px;">
                                                                     <img ng-src="data:image/jpeg;base64,[[user.avatar]]" class="entreprise-img rounded-img">
                                                                  </span>
                                                                  <div class="detail-devis" style="line-height: 21px;    color: #000;font-size: 15px;">
                                                                      <div>
                                                                          <span>[[user.firstname]] [[user.lastname]]</span>
                                                                      </div>
                                                                  </div>
                                                              </label>
                                                          </div>
                                                      </div>

                                                      <div class="text-center">
                                                         <input class="btn btn-primary" type="submit" name="all-chantier" value="imprimer pour tout les chantier">
                                                      </div>
                                                  </form>
                                                  <span id="extSubmit" ng-click="submitUserPrint(planning.categorie_id)" class="btn-small btn btn-primary" style="box-shadow: 0px 0px 10px 6px rgb(119 119 119 / 25%);position: absolute;top: 0;right: 9px;"><i class="fas fa-save"></i></span>
                                            </div>
                                          </div>
                                       </div>
                                       <span id="extSubmitFixed" class="btn-small btn btn-primary" style="box-shadow: 0px 0px 10px 6px rgb(119 119 119 / 25%);position: fixed;z-index: 9999;top: 18px;"><i class="fas fa-save"></i></span>
                                    </div>
                                </div>
                           </div>
                           <div class="loader-container flex-align-center d-flex" style="justify-content: center; display: flex;">
                              <img src="{{asset('images/loading.gif')}}" style="width: 54px;">
                           </div>
                        </div> 
                     </div>

                     <div id="modalUser" class="modal fade modalUserPlanning" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                           <div class="modal-content">
                             <div class="modal-header">
                               <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                               <h2 class="modal-title text-center" id="myModalLabel">Choisissez un utilisateur</h2>
                             </div>
                             <div class="modal-body" style="padding-top: 0">
                                   <form method="POST" id="modalPrintAllUserForm" action="{{path('planning_print_list')}}" target="_blank">
                                       <div class="entreprise-list list-user form-group" style="margin-top: 0">
                                           <div ng-repeat="user in users| orderBy:'lastname' track by $index">
                                             <input id="userItem-[[user.id]]" type="checkbox" name="user[]" value="[[user.id]]" style="display: none;" class="user-planified">
                                               <label for="userItem-[[user.id]]" class="switch-entreprise entreprise-item" style="cursor: pointer; justify-content: flex-start; align-items: flex-start; border-radius: 20px 5px 5px 24px;">
                                                   <span style="margin-right: 16px;">
                                                      <img ng-src="data:image/jpeg;base64,[[user.avatar]]" class="entreprise-img rounded-img">
                                                   </span>
                                                   <div class="detail-devis" style="line-height: 21px;    color: #000;font-size: 15px;">
                                                       <div>
                                                           <span>[[user.lastname]] [[user.firstname]]</span>
                                                       </div>
                                                   </div>
                                               </label>
                                           </div>
                                       </div>

                                   </form>
                                   <span id="extSubmit" ng-click="submitUserPrint(planning.categorie_id)" class="btn-small btn btn-primary" style="box-shadow: 0px 0px 10px 6px rgb(119 119 119 / 25%);position: absolute;top: 0;right: 9px;"><i class="fas fa-save"></i></span>
                             </div>
                           </div>
                        </div>
                        <span id="extSubmitFixed" class="btn-small btn btn-primary" style="box-shadow: 0px 0px 10px 6px rgb(119 119 119 / 25%);position: fixed;z-index: 9999;top: 18px;"><i class="fas fa-save"></i></span>
                     </div>

                     <div id="timeline-toggle" class="tab-planning-content-item">
                        <div class="d-flex flex-align-center" style="justify-content: space-between;  margin-bottom: 51px;">
                           <div></div>
                           <div class="option-right">
                              <select class="form-control" id="changeEcheance" ng-model="ECHEANCE" ng-change="changeEcheance()">
                                 <option value="JOURNALIERE">Jours</option>
                                 <option value="TRIMESTRIELLE">Trimestres</option>
                              </select>
                           </div>
                        </div>
                        <div class="timeline-container" id="timeline-container">
                           <table class="timeline-table">
                              <thead class="outer">
                                 <tr>
                                    <th class="th"></th>
                                    <th colspan="[[year.sub_head.length]]" class="th_year th_year_[[year.year]]" data-year="[[year.year]]" ng-repeat="year in timelines_year track by $index">
                                       <table>
                                          <thead class="inner">
                                             <tr>
                                                <td colspan="[[year.sub_head.length]]" style="font-weight: 100" ng-bind-html="year.head"></td>
                                             </tr>
                                             <tr  ng-if="year.echeance == 'JOURNALIERE'">
                                                <td style="position: relative;" ng-repeat="day in year.sub_head track by $index">
                                                   <div ng-repeat="date in year.date|limitTo:1:$index">
                                                      <div class="month-bar cell-date-[[date]]" data-month="[[date]]">[[day]]</div>
                                                   </div>
                                                </td>
                                             </tr>
                                             <tr ng-if="year.echeance == 'TRIMESTRIELLE'">
                                                <td class="" style="position: relative;">
                                                   <div class="td-timel-container">
                                                      <span ng-repeat="month in year.months| limitTo:1:0" class="td-timel-container">
                                                         <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
                                                      </span>
                                                   </div>
                                                   <span class="content-q-th">Q1</span>
                                                </td>
                                                <td class="" style="position: relative;">
                                                   <div class="td-timel-container">
                                                      <span ng-repeat="month in year.months| limitTo:1:1" class="td-timel-container">
                                                         <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
                                                      </span>
                                                   </div>
                                                   <span class="content-q-th">Q2</span>
                                                </td>
                                                <td class="" style="position: relative;">
                                                   <div class="td-timel-container">
                                                      <span ng-repeat="month in year.months| limitTo:1:2" class="td-timel-container">
                                                         <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
                                                      </span>
                                                   </div>
                                                   <span class="content-q-th">Q3</span>
                                                </td>
                                                <td class="" style="position: relative;">
                                                   <div class="td-timel-container" style="position: relative;">
                                                      <span ng-repeat="month in year.months| limitTo:1:3" class="td-timel-container">
                                                         <span ng-repeat="m in month" class="month-bar" data-month="[[m]]"></span>
                                                      </span>
                                                   </div>
                                                   <span class="content-q-th">Q4</span>
                                                </td>
                                             </tr>
                                          </thead>
                                       </table>
                                       <span style="display: none;">[[isEndLoopMonth(timelines_year.length, $index)]]</span>
                                    </th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr ng-repeat="timeline in timelines track by $index" class="timeline_user_row timeline_user_[[timeline.user.id]]" data-user=[[timeline.user.id]]>
                                    <th>
                                       <div style="display: flex;align-items: flex-start;">
                                          <div class="timeline-avatar">
                                             <img ng-src="data:image/jpeg;base64,[[timeline.user.avatar]]"
                                                class="rounded-img" ng-if="timeline.user.avatar" width="23px">
                                          </div>
                                          <div class="timeline-info-desc">
                                             <div class="prenom" style="font-weight: bold;">[[timeline.user.firstname]]</div>
                                             <div class="nom-prenom">[[timeline.user.firstname]] [[timeline.user.lastname]]</div>
                                             <div class="nom-email">[[timeline.user.email]]</div>
                                          </div>
                                       </div>
                                    </th>
                                    <td class="td-timel" colspan="[[tmln.taches.length]]" ng-repeat="tmln in timeline.timelines track by $index">
                                       <table class="table-cell">
                                          <tbody>
                                             <tr>
                                                <td class="tmln-td-body" ng-repeat="tache in tmln.taches track by $index">
                                                   <div id="[[t.identify_cell]]_[[t.id]]"  ng-repeat="t in tache track by $index" class="timeline-bar-[[timeline.user.id]] timeline-bar [[t.identify_cell]]" data-debut=[[t.debut]] data-semaine="[[tmln.data-semaine]]" data-categorie="[[t.categorieId]]" data-tache="[[t.id]]" data-user="[[timeline.user.id]]" data-fin=[[t.date_fin]] style="[[getPostionTimeline(t.debut, t.date_fin, t.identify_cell)]]; background: [[t.color]]" >
                                                      <div class="tooltip-timeline-bar">
                                                         <span class="nbr-day-timeline"></span>
                                                         <span class="new-date-start"></span>
                                                         <span class="new-date-end"></span>
                                                      </div>
                                                      <span class="crok-resize resizable-w">
                                                         <span>|</span>
                                                      </span>
                                                      <span>[[t.tache]]</span>
                                                      <span class="crok-resize resizable-e">
                                                         <span>|</span>
                                                      </span>
                                                   </div>
                                                </td>
                                             </tr>
                                          </tbody>
                                       </table>
                                    </td>
                                 </tr>
                                 <span style="display: none;">[[isEndLoopTimeline()]]</span>
                              </tbody>
                           </table>
                        </div>

                     </div>
                  </div>
               </div>






            </div>       
         </div>
      </div>
   </div>
</div>
{% endblock %}
{% block javascript_script %}
<script type="text/javascript">
   {#/*loadPointageRow(0);*/#}
   function loadPointageRow(offset){
       $.ajax({
           url:"{{path('planning_load_xhr')}}",
           type: "GET",
           dataType: "json",
           async: true,
           data: {
               offset:offset
           },
           success:function(response) {
               console.log(response);
               if(response.status == 200){
                   $('.planning-chantier-list').append(response.planning);
                   loadPointageRow(response.offset);
               }
               else if(response.status == 300){
                   /*toastr.success(response.message);*/
                   $('.loader-container').css('display','none');
   
               }
               else if(response.status == 500){
               }
               
           },
           error:function(){
               toastr.error("Ooops... Quelque chose s'est mal passée");
               $('.loader-container').css('display','none');
           }
       });
   }
</script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://npmcdn.com/flatpickr/dist/l10n/fr.js"></script>
<script src="{{asset('vendor/angular-lib/angular.js') }}" type="text/javascript"></script>
<script src="{{asset('vendor/angular-lib/angular-resource.js') }}" type="text/javascript"></script>
<script src="{{asset('vendor/angular-lib/angular-route.js') }}" type="text/javascript"></script>
<script src="{{asset('vendor/angular-lib/angular-sanitize.min.js') }}" type="text/javascript"></script>
<script src="{{asset('vendor/angular-lib/angular-ui-router.js') }}" type="text/javascript"></script>
<script src="{{asset('vendor/angular-lib/underscore.js') }}" type="text/javascript"></script>
<script src="{{asset('vendor/angular-lib/ui-bootstrap-tpls.min.js') }}" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.11.3/jquery-ui.min.js" integrity="sha256-xI/qyl9vpwWFOXz7+x/9WkG5j/SVnSw21viy8fWwbeE=" crossorigin="anonymous"></script>
<script type="text/javascript">

            
      let pos = { top: 0, left: 0, x: 0, y: 0 };
      const ele = document.getElementsByClassName('timeline-container')[0];

      const mouseDownHandler = function(e) {
         var timelineBar = $(".timeline-bar");
         if (!timelineBar.is(e.target) && timelineBar.has(e.target).length === 0){
             pos = {
                 // The current scroll 
                 left: ele.scrollLeft,
                 top: ele.scrollTop,
                 // Get the current mouse position
                 x: e.clientX,
                 y: e.clientY,
             };
             ele.style.cursor = 'grabbing';
             ele.style.userSelect = 'none';
             document.addEventListener('mousemove', mouseMoveHandler);
             document.addEventListener('mouseup', mouseUpHandler);
         }
      };

      const mouseMoveHandler = function(e) {
          // How far the mouse has been moved
          const dx = e.clientX - pos.x;
          const dy = e.clientY - pos.y;

          // Scroll the element
          ele.scrollTop = pos.top - dy;
          ele.scrollLeft = pos.left - dx;
      };

      const mouseUpHandler = function() {
         ele.style.cursor = 'grab';
         document.removeEventListener('mousemove', mouseMoveHandler);
         document.removeEventListener('mouseup', mouseUpHandler);
      };
      ele.addEventListener('mousedown', mouseDownHandler);

      $(document).mouseup(function(e) {
          var container_user = $(".user-dropdown");
          if (!container_user.is(e.target) && container_user.has(e.target).length === 0) 
              $('.user-dropdown').css('display','none')

          var container_status = $(".menu-status");
          if (!container_status.is(e.target) && container_status.has(e.target).length === 0){ 
              $('.menu-status').removeClass('menu__active');
          }

         var editing_elt = $("input.inputTache");
         if (!editing_elt.is(e.target) && editing_elt.has(e.target).length === 0){ 
              $('input.inputTache').addClass('no-editing');
              $('input.inputTache').attr("disabled", true);
         }
         var editing_elt = $("input.inputEmplacement");
         if (!editing_elt.is(e.target) && editing_elt.has(e.target).length === 0){ 
              $('input.inputEmplacement').addClass('no-editing');
              $('input.inputEmplacement').attr("disabled", true);
         }

         var editing_elt = $(".config-planning-container");
         if (!editing_elt.is(e.target) && editing_elt.has(e.target).length === 0){ 
           $('.config-planning-container').css('display', 'none');
           $('.config-color-container').css('display', 'none');
           $('input.input-planning-name').removeClass('focus');
         }
      });

      $(document).on("mouseover", '.user-profile-avatar', function() {
       $( '.user-profile-'+$(this).data('tache-id')+'-'+$(this).data('user-id') ).css('display', 'block');
       }
      );
      $(document).on("mouseout", '.user-profile-avatar', function() {
       $( '.profile-item' ).css('display', 'none');
       }
      );

      $('body').on('change', '.list-user input.user-planified', function() {
         if($(this).is(":checked"))
            $(this).next().addClass('active');
         else
            $(this).next().removeClass('active');
      });

      function printDiv(divName) {
           var printContents = document.getElementById(divName).innerHTML;
           var originalContents = document.body.innerHTML;

           document.body.innerHTML = printContents;

           window.print();

           document.body.innerHTML = originalContents;
      }


</script>
{% include "angular_module.html.twig" %}
{% endblock %}